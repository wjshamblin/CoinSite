---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';

export const prerender = false;

// Server-side rendering - get post by slug from URL params
const { slug } = Astro.params;

if (!slug) {
	return new Response('Post not found', { status: 404 });
}

// Find the post by slug (slug is an array for [...slug])
const postSlug = Array.isArray(slug) ? slug.join('/') : slug;

const posts = await getCollection('blog');
// Match against the post's slug property (which is derived from filename)
const post = posts.find(p => p.slug === postSlug);

if (!post) {
	return new Response('Post not found', { status: 404 });
}

const { Content } = await render(post);
---

<BlogPost {...post.data}>
	<Content />
</BlogPost>
