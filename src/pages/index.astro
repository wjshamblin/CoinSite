---
import Layout from '../layouts/Layout.astro';
import { db, Collections, Coins, eq } from 'astro:db';
import CoinSlideshow from '../components/CoinSlideshow.astro';
import { getImageUrl } from '../lib/images';

// Get featured collections for homepage
const featuredCollections = await db.select().from(Collections).limit(3);

// Get featured coins from database for slideshow
const featuredCoinsData = await db
	.select({
		coin: Coins,
		collectionName: Collections.name,
		collectionSlug: Collections.slug
	})
	.from(Coins)
	.innerJoin(Collections, eq(Coins.collectionId, Collections.id))
	.where(eq(Coins.featured, true))
	.limit(10);

// Transform to slideshow format
const featuredCoins = featuredCoinsData.map(({ coin, collectionName, collectionSlug }) => ({
	image: coin.primaryImage,
	title: coin.name,
	description: coin.description || '',
	collection: collectionName,
	link: `/collections/${collectionSlug}/${coin.slug}`
}));
---

<Layout title="Lord Marcovan Coin Collections">
	<!-- Hero Section -->
	<section class="hero">
		<div class="hero-content">
			<span class="hero-eyebrow">Numismatic Collection</span>
			<h1>Discover the Art of Ancient Coinage</h1>
			<p class="hero-description">
				Explore our carefully curated collection of historical coins spanning thousands of years.
				Each piece tells a story of civilizations, artistry, and the evolution of currency.
			</p>
			<div class="hero-actions">
				<a href="/collections" class="btn btn-primary">Explore Collections</a>
				<a href="/about" class="btn btn-outline">Learn More</a>
			</div>
		</div>
		<div class="hero-decoration">
			<div class="coin-ring coin-ring-1"></div>
			<div class="coin-ring coin-ring-2"></div>
			<div class="coin-ring coin-ring-3"></div>
		</div>
	</section>

	<!-- Featured Coins Slideshow (only shows when there are featured coins) -->
	{featuredCoins.length > 0 && (
		<section class="featured-coins">
			<div class="section-header">
				<span class="gold-accent"></span>
				<h2>Featured Coins</h2>
				<p class="section-description">
					Highlights from our collection showcasing exceptional examples of numismatic artistry
				</p>
			</div>
			<CoinSlideshow coins={featuredCoins} />
		</section>
	)}

	<!-- Collections Grid -->
	<section class="collections-section">
		<div class="section-header">
			<span class="gold-accent"></span>
			<h2>Collections</h2>
			<p class="section-description">
				Explore numismatic collections from ancient to modern, spanning the globe
			</p>
		</div>
		<div class="collections-grid">
			{featuredCollections.map((collection) => (
				<a href={`/collections/${collection.slug}`} class="collection-card">
					<div class="collection-image-wrapper">
						<img
							src={getImageUrl(collection.thumbnail, 'collections')}
							alt={collection.name}
							width="400"
							height="280"
							class="collection-image"
							loading="lazy"
						/>
						<div class="collection-overlay"></div>
					</div>
					<div class="collection-content">
						<h3>{collection.name}</h3>
						<p>{collection.description}</p>
						<span class="collection-link">
							View Collection
							<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
								<path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</span>
					</div>
				</a>
			))}
		</div>
		<div class="collections-cta">
			<a href="/collections" class="btn btn-secondary">View All Collections</a>
		</div>
	</section>

	<!-- About Section -->
	<section class="about-section">
		<div class="about-container">
			<div class="about-content">
				<span class="gold-accent"></span>
				<h2>About the Collection</h2>
				<p>
					Our numismatic collection spans thousands of years of human history, from ancient Greek city-states
					to modern commemorative issues. Each piece is carefully selected for its historical significance,
					artistic merit, and condition.
				</p>
				<p>
					Explore individual coins with high-resolution photography showing obverse, reverse, and
					detailed views. Learn about mintages, historical context, and the fascinating stories behind each piece.
				</p>
				<a href="/about" class="about-link">
					Learn more about our collection
					<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
						<path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				</a>
			</div>
			<div class="about-stats">
				<div class="stat-card">
					<span class="stat-number">6</span>
					<span class="stat-label">Collections</span>
				</div>
				<div class="stat-card">
					<span class="stat-number">200+</span>
					<span class="stat-label">Coins</span>
				</div>
				<div class="stat-card">
					<span class="stat-number">1000+</span>
					<span class="stat-label">Images</span>
				</div>
				<div class="stat-card">
					<span class="stat-number">2500</span>
					<span class="stat-label">Years of History</span>
				</div>
			</div>
		</div>
	</section>
</Layout>

<style>
	/* Hero Section */
	.hero {
		position: relative;
		text-align: center;
		padding: 5rem 2rem 6rem;
		background: linear-gradient(135deg, var(--gold-light) 0%, var(--cream) 50%, rgba(122, 117, 109, 0.1) 100%);
		border-radius: 16px;
		margin-bottom: 5rem;
		overflow: hidden;
	}

	.hero-content {
		position: relative;
		z-index: 2;
		max-width: 700px;
		margin: 0 auto;
	}

	.hero-eyebrow {
		display: inline-block;
		font-size: 0.8125rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.15em;
		color: var(--gold-dark);
		margin-bottom: 1rem;
	}

	.hero h1 {
		font-size: clamp(2.25rem, 6vw, 3.75rem);
		margin-bottom: 1.25rem;
		background: linear-gradient(135deg, var(--navy) 0%, var(--gold-dark) 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.hero-description {
		font-size: 1.125rem;
		color: var(--navy-light);
		max-width: 560px;
		margin: 0 auto 2rem;
		line-height: 1.7;
	}

	.hero-actions {
		display: flex;
		gap: 1rem;
		justify-content: center;
		flex-wrap: wrap;
	}

	/* Decorative coin rings */
	.hero-decoration {
		position: absolute;
		top: 50%;
		right: -5%;
		transform: translateY(-50%);
		width: 400px;
		height: 400px;
		opacity: 0.15;
		pointer-events: none;
	}

	.coin-ring {
		position: absolute;
		border: 2px solid var(--gold);
		border-radius: 50%;
	}

	.coin-ring-1 {
		width: 300px;
		height: 300px;
		top: 50px;
		left: 50px;
	}

	.coin-ring-2 {
		width: 200px;
		height: 200px;
		top: 100px;
		left: 100px;
	}

	.coin-ring-3 {
		width: 100px;
		height: 100px;
		top: 150px;
		left: 150px;
		background: var(--gold);
		opacity: 0.3;
	}

	/* Section Headers */
	.section-header {
		text-align: center;
		margin-bottom: 3rem;
	}

	.section-header h2 {
		margin: 1rem 0 0.75rem;
	}

	.section-description {
		color: rgb(var(--gray));
		font-size: 1.0625rem;
		max-width: 500px;
		margin: 0 auto;
	}

	/* Featured Coins */
	.featured-coins {
		margin-bottom: 5rem;
	}

	/* Collections Section */
	.collections-section {
		margin-bottom: 5rem;
	}

	.collections-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
		gap: 2rem;
		margin-bottom: 2.5rem;
	}

	.collection-card {
		display: block;
		background: white;
		border-radius: 12px;
		overflow: hidden;
		text-decoration: none;
		color: inherit;
		box-shadow: var(--shadow-md);
		transition: all var(--transition-base);
	}

	.collection-card:hover {
		transform: translateY(-6px);
		box-shadow: var(--shadow-xl);
	}

	.collection-image-wrapper {
		position: relative;
		overflow: hidden;
	}

	.collection-image {
		width: 100%;
		height: 220px;
		object-fit: contain;
		background: #f5f5f0;
		transition: transform var(--transition-slow);
	}

	.collection-card:hover .collection-image {
		transform: scale(1.05);
	}

	.collection-overlay {
		position: absolute;
		inset: 0;
		background: linear-gradient(to top, rgba(15, 23, 42, 0.6) 0%, transparent 50%);
		opacity: 0;
		transition: opacity var(--transition-base);
	}

	.collection-card:hover .collection-overlay {
		opacity: 1;
	}

	.collection-content {
		padding: 1.5rem;
	}

	.collection-content h3 {
		font-size: 1.25rem;
		margin-bottom: 0.5rem;
		color: var(--navy);
	}

	.collection-content p {
		color: rgb(var(--gray));
		font-size: 0.9375rem;
		line-height: 1.6;
		margin-bottom: 1rem;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.collection-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		color: var(--gold-dark);
		font-size: 0.9375rem;
		font-weight: 600;
		transition: gap var(--transition-fast);
	}

	.collection-card:hover .collection-link {
		gap: 0.75rem;
	}

	.collections-cta {
		text-align: center;
	}

	/* About Section */
	.about-section {
		background: white;
		border-radius: 16px;
		padding: 4rem 2rem;
		margin-bottom: 2rem;
		box-shadow: var(--shadow-md);
	}

	.about-container {
		display: grid;
		grid-template-columns: 1fr;
		gap: 3rem;
		max-width: 1100px;
		margin: 0 auto;
	}

	@media (min-width: 768px) {
		.about-container {
			grid-template-columns: 1.2fr 1fr;
			align-items: center;
		}
	}

	.about-content h2 {
		margin-top: 1rem;
		margin-bottom: 1.5rem;
	}

	.about-content p {
		color: rgb(var(--gray));
		line-height: 1.75;
	}

	.about-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		color: var(--gold-dark);
		font-weight: 600;
		transition: gap var(--transition-fast);
	}

	.about-link:hover {
		gap: 0.75rem;
	}

	.about-stats {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: 1.5rem;
	}

	.stat-card {
		background: var(--cream);
		padding: 1.75rem;
		border-radius: 12px;
		text-align: center;
		border: 1px solid rgba(122, 117, 109, 0.2);
	}

	.stat-number {
		display: block;
		font-family: Georgia, "Times New Roman", serif;
		font-size: 2.25rem;
		font-weight: 700;
		color: var(--gold-dark);
		margin-bottom: 0.25rem;
	}

	.stat-label {
		color: rgb(var(--gray));
		font-size: 0.875rem;
		text-transform: uppercase;
		letter-spacing: 0.05em;
	}

	/* Responsive adjustments */
	@media (max-width: 768px) {
		.hero {
			padding: 3rem 1.5rem 4rem;
			margin-bottom: 3rem;
		}

		.hero-decoration {
			display: none;
		}

		.featured-coins,
		.collections-section {
			margin-bottom: 3rem;
		}

		.about-section {
			padding: 2.5rem 1.5rem;
		}

		.about-stats {
			grid-template-columns: repeat(2, 1fr);
		}

		.stat-card {
			padding: 1.25rem;
		}

		.stat-number {
			font-size: 1.75rem;
		}
	}
</style>
