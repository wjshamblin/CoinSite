---
import BaseHead from '../components/BaseHead.astro';
import { getSessionFromRequest, getSessionUser } from '../lib/auth';

export interface Props {
	title: string;
	description?: string;
}

const { title, description = 'Admin Panel - Coin Collection Management' } = Astro.props;

// Get current user for display
const sessionToken = getSessionFromRequest(Astro.request);
const user = sessionToken ? await getSessionUser(sessionToken) : null;
---

<html lang="en">
	<head>
		<BaseHead title={`Admin - ${title}`} description={description} />
		<style>
			* {
				box-sizing: border-box;
			}

			body {
				font-family: system-ui, sans-serif;
				margin: 0;
				background: #f5f5f5;
			}

			.admin-container {
				display: flex;
				min-height: 100vh;
			}

			.admin-sidebar {
				width: 250px;
				background: #2c3e50;
				color: white;
				padding: 0;
				position: fixed;
				height: 100vh;
				overflow-y: auto;
			}

			.admin-header {
				padding: 1.5rem;
				border-bottom: 1px solid #34495e;
				background: #1a252f;
			}

			.admin-header h1 {
				margin: 0;
				font-size: 1.2rem;
				color: #ecf0f1;
			}

			.user-info {
				margin-top: 0.5rem;
				opacity: 0.8;
			}

			.user-info small {
				font-size: 0.8rem;
				color: #bdc3c7;
			}

			.user-info strong {
				color: #ecf0f1;
			}

			.admin-nav {
				padding: 0;
			}

			.admin-nav ul {
				list-style: none;
				margin: 0;
				padding: 0;
			}

			.admin-nav li {
				margin: 0;
			}

			.admin-nav a {
				display: block;
				padding: 1rem 1.5rem;
				color: #bdc3c7;
				text-decoration: none;
				border-bottom: 1px solid #34495e;
				transition: all 0.3s ease;
			}

			.admin-nav a:hover,
			.admin-nav a.active {
				background: #34495e;
				color: #ecf0f1;
				border-left: 4px solid #3498db;
				padding-left: calc(1.5rem - 4px);
			}

			.admin-nav .nav-icon {
				margin-right: 0.75rem;
				width: 16px;
				display: inline-block;
			}

			.admin-main {
				flex: 1;
				margin-left: 250px;
				padding: 2rem;
				background: white;
				min-height: 100vh;
			}

			.admin-breadcrumb {
				margin-bottom: 2rem;
				padding-bottom: 1rem;
				border-bottom: 1px solid #eee;
			}

			.admin-breadcrumb a {
				color: #3498db;
				text-decoration: none;
			}

			.admin-breadcrumb a:hover {
				text-decoration: underline;
			}

			@media (max-width: 768px) {
				.admin-sidebar {
					transform: translateX(-100%);
					transition: transform 0.3s ease;
				}

				.admin-main {
					margin-left: 0;
				}

				.mobile-menu-open .admin-sidebar {
					transform: translateX(0);
				}
			}
		</style>
	</head>

	<body>
		<div class="admin-container">
			<aside class="admin-sidebar">
				<div class="admin-header">
					<h1>🪙 Admin Panel</h1>
					{user && (
						<div class="user-info">
							<small>Logged in as: <strong>{user.username}</strong></small>
						</div>
					)}
				</div>
				<nav class="admin-nav">
					<ul>
						<li><a href="/admin" class={Astro.url.pathname === '/admin' ? 'active' : ''}>
							<span class="nav-icon">📊</span>Dashboard
						</a></li>
						<li><a href="/admin/collections" class={Astro.url.pathname.startsWith('/admin/collections') ? 'active' : ''}>
							<span class="nav-icon">📚</span>Collections
						</a></li>
						<li><a href="/admin/coins" class={Astro.url.pathname.startsWith('/admin/coins') ? 'active' : ''}>
							<span class="nav-icon">🪙</span>Coins
						</a></li>
						<li><a href="/admin/images" class={Astro.url.pathname.startsWith('/admin/images') ? 'active' : ''}>
							<span class="nav-icon">🖼️</span>Images
						</a></li>
						<li><a href="/admin/blog" class={Astro.url.pathname.startsWith('/admin/blog') ? 'active' : ''}>
							<span class="nav-icon">✍️</span>Blog Posts
						</a></li>
						<li style="margin-top: 2rem; border-top: 1px solid #34495e; padding-top: 1rem;">
							<a href="/" target="_blank">
								<span class="nav-icon">🌐</span>View Site
							</a>
						</li>
						<li>
							<a href="/admin/logout">
								<span class="nav-icon">🚪</span>Logout
							</a>
						</li>
					</ul>
				</nav>
			</aside>

			<main class="admin-main">
				<div class="admin-breadcrumb">
					<a href="/admin">Admin</a>
					{Astro.url.pathname !== '/admin' && (
						<span> / {title}</span>
					)}
				</div>
				<slot />
			</main>
		</div>

		<script>
			// Mobile menu toggle (simple implementation)
			function toggleMobileMenu() {
				document.body.classList.toggle('mobile-menu-open');
			}
		</script>
	</body>
</html>