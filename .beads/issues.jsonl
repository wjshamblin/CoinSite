{"id":"CoinSite-1hx","title":"Set up proper logging system","description":"All error handling currently uses `console.error`. Errors are lost in production.\n\n**Issues:**\n- No structured logging\n- No log levels (debug, info, warn, error)\n- No log aggregation capability\n- Errors not persisted\n\n**Recommended solution:**\n- Use Pino for structured JSON logging\n- Configure log levels per environment\n- Add request ID tracking\n- Consider log shipping to external service\n\n**Files using console.error:**\n- src/lib/auth.ts (lines 40, 97, 104, 114)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-20T08:31:32.790156-05:00","updated_at":"2025-12-20T08:31:32.790156-05:00","labels":["infrastructure"]}
{"id":"CoinSite-4gp","title":"Add Secure flag to session cookies","description":"Session cookies in src/lib/auth.ts:130 are missing the Secure flag. This makes them vulnerable to man-in-the-middle attacks when transmitted over HTTP.\n\n**Current:**\n```typescript\nreturn `admin_session=${sessionToken}; Path=/; HttpOnly; SameSite=Strict; Expires=${expires.toUTCString()}`;\n```\n\n**Fix:**\n```typescript\nreturn `admin_session=${sessionToken}; Path=/; HttpOnly; Secure; SameSite=Strict; Expires=${expires.toUTCString()}`;\n```\n\nThe Secure flag ensures cookies are only sent over HTTPS connections.","status":"open","priority":0,"issue_type":"bug","created_at":"2025-12-20T08:29:36.265146-05:00","updated_at":"2025-12-20T08:29:36.265146-05:00","labels":["critical","security"]}
{"id":"CoinSite-4k2","title":"Remove hardcoded demo credentials from login page","description":"The admin login page (src/pages/admin/login.astro:205-209) displays hardcoded demo credentials (admin/admin123) in the UI. This is a security risk for production.\n\n**Issues:**\n- Demo credentials visible to all users\n- Default password 'admin123' is also hardcoded in create-admin.ts\n\n**Fix:**\n1. Remove the demo-info div from login.astro\n2. Use environment variables for initial admin setup\n3. Force password change on first login","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T08:29:40.590569-05:00","updated_at":"2025-12-20T09:57:14.8609-05:00","closed_at":"2025-12-20T09:57:14.8609-05:00","close_reason":"Removed demo credentials from login page","labels":["critical","security"]}
{"id":"CoinSite-9z6","title":"Add CSRF tokens to forms","description":"Forms lack CSRF (Cross-Site Request Forgery) protection. Attackers could trick authenticated users into performing unwanted actions.\n\n**Vulnerable forms:**\n- /admin/login (POST)\n- /admin/coins/new (POST)\n- /admin/collections/new (POST)\n- /admin/blog/new (POST)\n- All edit forms\n\n**Implementation:**\n1. Generate CSRF token on page load\n2. Include token in hidden form field\n3. Validate token on form submission\n4. Regenerate token after successful submission\n\nConsider using a library like csrf-csrf or implementing custom middleware.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-20T08:32:24.376014-05:00","updated_at":"2025-12-20T08:32:24.376014-05:00","labels":["security"]}
{"id":"CoinSite-ak9","title":"Add comprehensive test suite","description":"The project has zero test coverage. Critical for authentication system reliability.\n\n**Test types needed:**\n1. **Unit tests** - Auth functions (verifyPassword, createSession, etc.)\n2. **Integration tests** - Database operations, API endpoints\n3. **E2E tests** - Login flow, admin CRUD operations\n\n**Recommended tools:**\n- Vitest for unit/integration tests\n- Playwright for E2E tests\n\n**Priority test targets:**\n- src/lib/auth.ts - All authentication functions\n- src/pages/admin/api/* - API endpoints\n- Session management flows","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-20T08:31:29.8847-05:00","updated_at":"2025-12-20T08:31:29.8847-05:00","labels":["testing"]}
{"id":"CoinSite-ehp","title":"Fix Vercel deployment to use remote Turso database","description":"The site was returning 500 errors on Vercel because:\n\n1. The build script in package.json hardcoded `ASTRO_DATABASE_FILE=./db.sqlite`\n2. This forced local SQLite even when Turso env vars were set\n3. At runtime, Vercel tried to open /var/task/db.sqlite which doesn't exist\n\n**Root cause:** Conflict between global 'astro' command (Astronomer CLI) and npx astro (Astro framework)\n\n**Fix:**\n- Changed build script from `ASTRO_DATABASE_FILE=./db.sqlite astro build` to `astro build`\n- Added `build:local` script for local development with SQLite\n- Set up Turso database with ASTRO_DB_REMOTE_URL and ASTRO_DB_APP_TOKEN in Vercel\n- Pushed schema and seeded remote database\n\n**Files changed:**\n- package.json\n- .env (local, not committed)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T09:13:08.367412-05:00","updated_at":"2025-12-20T09:13:34.329887-05:00","closed_at":"2025-12-20T09:13:34.329887-05:00","close_reason":"Fixed by updating package.json build script and configuring Turso","labels":["deployment","infrastructure"]}
{"id":"CoinSite-gym","title":"Create shared form components","description":"Admin pages duplicate form markup extensively. Need reusable form components.\n\n**Components to create:**\n- FormInput - text/email/password input with label and error handling\n- FormTextarea - textarea with label\n- FormSelect - dropdown select\n- FormButton - styled submit/action buttons\n- FormGroup - wrapper for form field groups\n\n**Files with duplicated form code:**\n- src/pages/admin/coins/new.astro\n- src/pages/admin/coins/edit/[id].astro\n- src/pages/admin/collections/new.astro\n- src/pages/admin/collections/edit/[id].astro\n- src/pages/admin/blog/new.astro","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-20T08:31:26.52166-05:00","updated_at":"2025-12-20T08:31:26.52166-05:00","labels":["refactor","ui"]}
{"id":"CoinSite-ht7","title":"Fix session cleanup logic bug in auth.ts","description":"The cleanExpiredSessions() function in src/lib/auth.ts:111 uses eq() instead of lt() operator. This means expired sessions are NEVER cleaned up. Sessions will accumulate indefinitely, creating security risk and database bloat.\n\n**Current (broken):**\n```typescript\nawait db.delete(AdminSessions).where(eq(AdminSessions.expiresAt, now));\n```\n\n**Fix:**\n```typescript  \nawait db.delete(AdminSessions).where(lt(AdminSessions.expiresAt, now));\n```\n\nImport `lt` from astro:db alongside existing imports.","status":"open","priority":0,"issue_type":"bug","created_at":"2025-12-20T08:29:30.943013-05:00","updated_at":"2025-12-20T08:29:30.943013-05:00","labels":["critical","security"]}
{"id":"CoinSite-log","title":"Fix login page: remove demo credentials and fix cookie redirect","description":"Two issues with login page:\n\n1. Demo credentials were displayed publicly (security risk)\n2. Login didn't work because Astro.redirect() creates a new Response object, \n   losing the Set-Cookie header that was set on Astro.response\n\n**Fix:**\n- Removed demo credentials div and associated CSS\n- Changed redirect to use new Response() with both Location and Set-Cookie headers","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T09:57:09.313527-05:00","updated_at":"2025-12-20T09:57:14.755678-05:00","closed_at":"2025-12-20T09:57:14.755678-05:00","close_reason":"Fixed cookie redirect and removed demo credentials","labels":["security"]}
{"id":"CoinSite-m7q","title":"Implement rate limiting on authentication endpoints","description":"There is no rate limiting on the login endpoint, allowing unlimited password attempts. This makes the system vulnerable to brute-force attacks.\n\n**Implementation options:**\n1. Use a rate limiting middleware (e.g., express-rate-limit pattern)\n2. Track failed attempts per IP in the database\n3. Implement exponential backoff after failed attempts\n4. Consider account lockout after N failed attempts\n\n**Endpoints to protect:**\n- POST /admin/login\n- POST /admin/api/create-admin","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-20T08:29:43.1659-05:00","updated_at":"2025-12-20T08:29:43.1659-05:00","labels":["security"]}
{"id":"CoinSite-n6h","title":"Remove db.sqlite from git tracking","description":"The SQLite database file (db.sqlite) is tracked in git and contains sensitive data including password hashes. This is a security vulnerability.\n\n**Steps to fix:**\n1. Add db.sqlite to .gitignore\n2. Remove from git tracking: `git rm --cached db.sqlite`\n3. Commit the .gitignore change\n4. Document how to seed a fresh database for new developers","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T08:29:38.553959-05:00","updated_at":"2025-12-20T09:14:31.171468-05:00","closed_at":"2025-12-20T09:14:31.171468-05:00","close_reason":"Added db.sqlite to .gitignore and removed from git tracking","labels":["critical","security"]}
{"id":"CoinSite-rlc","title":"Extract CSS to design system or Tailwind","description":"Every component has massive inline `\u003cstyle\u003e` blocks (100+ lines each). This leads to:\n- Duplicated color values and spacing rules\n- No consistent design system\n- Difficult maintenance\n\n**Options:**\n1. **Tailwind CSS** - Add via `npx astro add tailwind`\n2. **CSS Modules** - Use scoped CSS files\n3. **Design tokens** - Extract colors, spacing, typography to CSS variables\n\n**Files with large style blocks:**\n- src/components/CoinSlideshow.astro (~200 lines)\n- src/pages/admin/login.astro (~150 lines)\n- src/pages/index.astro (~160 lines)\n- Most admin pages (100+ lines each)","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-20T08:31:17.940325-05:00","updated_at":"2025-12-20T08:31:17.940325-05:00","labels":["refactor","ui"]}
{"id":"CoinSite-zto","title":"Fix admin authentication redirect not working","description":"The requireAuth middleware was returning a Response object for redirects, but the admin pages weren't handling it properly. The redirect was being returned but not actually executed, allowing unauthenticated access to all admin pages.\n\n**Fix:**\n- Added isRedirect() type guard to authMiddleware.ts  \n- Updated all 10 admin pages to check for redirect response and return it\n- Pattern: `if (isRedirect(authResult)) return authResult;`\n\n**Files changed:**\n- src/lib/authMiddleware.ts\n- All files in src/pages/admin/","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-20T09:32:15.622565-05:00","updated_at":"2025-12-20T09:32:22.572571-05:00","closed_at":"2025-12-20T09:32:22.572571-05:00","close_reason":"Fixed redirect handling in all admin pages","labels":["security"]}
